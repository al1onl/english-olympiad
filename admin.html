<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Адмін панель - Олімпіада</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="admin-panel">
            <div class="admin-header">
                <h1>⚙️ Адмін панель</h1>
                <button class="btn-secondary" id="adminLogoutBtn">← Вийти</button>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="create">Створити користувача</button>
                <button class="tab" data-tab="users">Список користувачів</button>
                <button class="tab" data-tab="stats">Статистика</button>
            </div>

            <div id="createPanel" class="panel active">
                <h2>Створити нового користувача</h2>
                <div class="form-group">
                    <label>Ім'я учня:</label>
                    <input type="text" id="newUserName" placeholder="Введіть ім'я учня">
                </div>
                <div class="form-group">
                    <label>Клас:</label>
                    <select id="newUserClass">
                        <option value="9">9 клас</option>
                        <option value="10" selected>10 клас</option>
                        <option value="11">11 клас</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Група (опціонально):</label>
                    <input type="text" id="newUserGroup" placeholder="Назва групи або класу">
                </div>
                <button id="createUserBtn" class="btn-primary">Створити користувача</button>
                
                <div id="createdCredentials" class="credentials-box" style="display: none;">
                    <h3>✅ Користувача створено!</h3>
                    <div id="credentialsInfo"></div>
                    <button id="copyCredentialsBtn" class="btn-secondary">Копіювати дані</button>
                </div>
            </div>

            <div id="usersPanel" class="panel">
                <h2>Список користувачів</h2>
                <div class="search-box">
                    <input type="text" id="userSearch" placeholder="Пошук за іменем або логіном...">
                </div>
                <div class="user-list" id="usersListContainer">
                    <!-- Список буде заповнений через JavaScript -->
                </div>
            </div>

            <div id="statsPanel" class="panel">
                <h2>Статистика системи</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">Всього користувачів</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="class9Users">0</div>
                        <div class="stat-label">9 клас</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="class10Users">0</div>
                        <div class="stat-label">10 клас</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="class11Users">0</div>
                        <div class="stat-label">11 клас</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Перевірка авторизації адміна
        if (localStorage.getItem('admin_authenticated') !== 'true') {
            window.location.href = 'index.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Обробники вкладок
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchAdminTab(tabName);
                });
            });

            // Обробник створення користувача
            document.getElementById('createUserBtn').addEventListener('click', createUser);

            // Обробник пошуку
            document.getElementById('userSearch').addEventListener('input', function(e) {
                filterUsers(e.target.value);
            });

            // Обробник виходу
            document.getElementById('adminLogoutBtn').addEventListener('click', function() {
                localStorage.removeItem('admin_authenticated');
                window.location.href = 'index.html';
            });

            // Завантажити початкові дані
            updateUsersList();
            updateStats();
        });

        function switchAdminTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}Panel`).classList.add('active');
            
            if (tabName === 'users') updateUsersList();
            if (tabName === 'stats') updateStats();
        }

        function createUser() {
            const name = document.getElementById('newUserName').value.trim();
            const studentClass = document.getElementById('newUserClass').value;
            const group = document.getElementById('newUserGroup').value.trim();
            
            if (!name) {
                alert('Будь ласка, введіть ім\'я учня');
                return;
            }
            
            const login = generateLogin(name);
            const password = generatePassword();
            
            const newUser = {
                id: Date.now(),
                name: name,
                class: studentClass,
                group: group,
                login: login,
                password: password,
                created: new Date().toLocaleString('uk-UA')
            };
            
            const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
            users.push(newUser);
            localStorage.setItem('olympiad_users', JSON.stringify(users));
            
            showCreatedCredentials(newUser);
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserGroup').value = '';
            updateStats();
        }

        function generateLogin(name) {
            const base = name.toLowerCase().replace(/\s+/g, '').substring(0, 8);
            const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
            let login = base;
            let counter = 1;
            
            while (users.find(user => user.login === login)) {
                login = base + counter;
                counter++;
            }
            return login;
        }

        function generatePassword() {
            return Math.random().toString(36).slice(-8);
        }

        function showCreatedCredentials(user) {
            const credentialsBox = document.getElementById('createdCredentials');
            const credentialsInfo = document.getElementById('credentialsInfo');
            
            credentialsInfo.innerHTML = `
                <p><strong>Ім'я:</strong> ${user.name}</p>
                <p><strong>Клас:</strong> ${user.class}</p>
                <p><strong>Логін:</strong> ${user.login}</p>
                <p><strong>Пароль:</strong> ${user.password}</p>
                <p><strong>Дата створення:</strong> ${user.created}</p>
            `;
            
            credentialsBox.style.display = 'block';
            
            document.getElementById('copyCredentialsBtn').onclick = function() {
                const text = `Ім'я: ${user.name}\nКлас: ${user.class}\nЛогін: ${user.login}\nПароль: ${user.password}`;
                navigator.clipboard.writeText(text);
                alert('Дані скопійовано!');
            };
        }

        function updateUsersList() {
            const container = document.getElementById('usersListContainer');
            const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">Користувачів ще не створено</div>';
                return;
            }
            
            container.innerHTML = `
                <div class="user-item header">
                    <div>Ім'я</div>
                    <div>Клас</div>
                    <div>Логін</div>
                    <div>Пароль</div>
                    <div>Дата створення</div>
                    <div>Дії</div>
                </div>
                ${users.map(user => `
                    <div class="user-item">
                        <div>${user.name}</div>
                        <div>${user.class} клас</div>
                        <div>${user.login}</div>
                        <div>${user.password}</div>
                        <div>${user.created}</div>
                        <div>
                            <button class="btn-danger" onclick="deleteUser(${user.id})">Видалити</button>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function filterUsers(searchTerm) {
            const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
            const filtered = users.filter(user => 
                user.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                user.login.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            const container = document.getElementById('usersListContainer');
            if (filtered.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">Користувачів не знайдено</div>';
            } else {
                container.innerHTML = `
                    <div class="user-item header">
                        <div>Ім'я</div>
                        <div>Клас</div>
                        <div>Логін</div>
                        <div>Пароль</div>
                        <div>Дата створення</div>
                        <div>Дії</div>
                    </div>
                    ${filtered.map(user => `
                        <div class="user-item">
                            <div>${user.name}</div>
                            <div>${user.class} клас</div>
                            <div>${user.login}</div>
                            <div>${user.password}</div>
                            <div>${user.created}</div>
                            <div>
                                <button class="btn-danger" onclick="deleteUser(${user.id})">Видалити</button>
                            </div>
                        </div>
                    `).join('')}
                `;
            }
        }

        function deleteUser(userId) {
            if (confirm('Видалити цього користувача?')) {
                const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
                const updatedUsers = users.filter(user => user.id !== userId);
                localStorage.setItem('olympiad_users', JSON.stringify(updatedUsers));
                updateUsersList();
                updateStats();
            }
        }

        function updateStats() {
            const users = JSON.parse(localStorage.getItem('olympiad_users')) || [];
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('class9Users').textContent = users.filter(u => u.class == 9).length;
            document.getElementById('class10Users').textContent = users.filter(u => u.class == 10).length;
            document.getElementById('class11Users').textContent = users.filter(u => u.class == 11).length;
        }
    </script>
</body>
</html>
