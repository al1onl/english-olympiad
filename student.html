<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#1a1a1a">
  <meta name="description" content="–û–ª—ñ–º–ø—ñ–∞–¥–∞ –∑ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏ –¥–ª—è 10 –∫–ª–∞—Å—É">
  <title>–û–ª—ñ–º–ø—ñ–∞–¥–∞ –∑ –ê–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏ ‚Äî 10 –∫–ª–∞—Å (Hard) ‚Äî Final</title>
  <style>
    :root{
      --bg:#0d0d0d;
      --panel:#1a1a1a;
      --card:#1a1a1a;
      --accent:#0066cc;
      --muted:#404040;
      --danger:#cc0000;
      --text-dark:#ffffff;
      --text-light:#b3b3b3;
      --correct:#00a300;
      --wrong:#cc0000;
      --border:#404040;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;background:var(--bg);color:var(--text-dark)}
    body{display:flex;align-items:flex-start;justify-content:center;padding:20px}
    .app{width:100%;max-width:1200px}
    header{display:flex;justify-content:space-between;align-items:center;color:#fff;margin-bottom:14px;background:var(--panel);padding:20px;border-radius:12px;border:1px solid var(--border)}
    .brand{display:flex;flex-direction:column}
    h1{font-size:20px;margin:0}
    .subtitle{font-size:13px;color:var(--text-light)}

    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:0 8px 32px rgba(0,0,0,0.3)}

    /* Intro */
    .intro-grid{display:grid;grid-template-columns:1fr 340px;gap:14px;align-items:start}
    input[type=text],input[type=password],textarea,select{padding:12px;border-radius:8px;border:1px solid var(--border);font-size:15px;background:var(--bg);color:var(--text-dark)}
    input[readonly]{background:var(--muted)}
    .btn{padding:12px 20px;border-radius:8px;border:none;font-weight:600;cursor:pointer;transition:all 0.3s ease}
    .btn-primary{background:var(--accent);color:white}
    .btn-primary:hover{background:#0052a3;transform:translateY(-1px)}
    .btn-danger{background:var(--danger);color:white}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text-light)}

    .info-box{background:var(--panel);padding:16px;border-radius:10px;border:1px solid var(--border)}

    /* Plaque */
    .plaque{position:fixed;left:50%;bottom:20px;transform:translateX(-50%) translateY(110%);background:var(--danger);color:white;padding:12px 18px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.45);display:none;z-index:2200;font-weight:700;min-width:260px;text-align:center}

    /* Tasks */
    #tasks{display:none;margin-top:14px}
    .screen{display:none;padding:16px;border-radius:10px}
    .screen.active{display:block}
    .task-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--border)}

    .task-box{background:var(--panel);padding:20px;border-radius:10px;border:1px solid var(--border);color:var(--text-dark)}
    .question{font-size:16px;margin:0 0 12px 0;font-weight:600}
    .hint{font-size:13px;color:var(--text-light);background:var(--muted);padding:10px;border-radius:6px;margin-bottom:12px;border-left:3px solid var(--accent)}

    .options{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .option{background:transparent;border:1px solid var(--border);padding:12px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:10px}

    /* Timer and nav */
    .top-right{display:flex;gap:10px;align-items:center}
    .timer{background:var(--accent);color:#fff;padding:10px 15px;border-radius:8px;font-weight:700;min-width:140px;text-align:center;font-family:'Courier New',monospace}
    .prev-pill{background:var(--panel);padding:8px 12px;border-radius:8px;border:1px solid var(--border);cursor:pointer;color:var(--text-light)}

    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}

    /* Result */
    .result{display:none;background:var(--panel);padding:20px;border-radius:10px;margin-top:16px;border:1px solid var(--border)}
    .correct{color:var(--correct);font-weight:700}
    .wrong{color:var(--wrong);font-weight:700}

    .correct-bg{background:rgba(0,163,0,0.12);border-radius:6px;padding:8px;border:1px solid var(--correct)}
    .wrong-bg{background:rgba(204,0,0,0.12);border-radius:6px;padding:8px;border:1px solid var(--wrong)}

    .big-note{background:var(--accent);color:white;padding:12px;border-radius:8px;margin-top:12px;font-weight:700;text-align:center}

    footer.note{color:var(--text-light);font-size:14px;margin-top:12px;text-align:center;background:var(--panel);padding:12px;border-radius:8px;border:1px solid var(--border)}

    /* View mode navigation */
    .view-nav{display:none;justify-content:center;gap:20px;margin:20px 0}
    .view-nav-btn{background:var(--accent);color:white;padding:12px 24px;border-radius:8px;border:none;cursor:pointer;font-weight:600}

    /* Fullscreen warning */
    .fullscreen-warning{background:var(--danger);color:white;padding:12px;border-radius:8px;margin-top:12px;text-align:center;font-weight:700;display:none}

    /* Fullscreen modal */
    .fullscreen-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }
    .fullscreen-modal-content {
      background: var(--panel);
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      max-width: 500px;
      margin: 20px;
      border: 1px solid var(--border);
    }
    .fullscreen-modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    /* Security warning */
    .security-warning {
      background: #cc7a00;
      color: white;
      padding: 10px 12px;
      border-radius: 6px;
      margin: 10px 0;
      text-align: center;
      font-size: 12px;
      border-left: 4px solid #ff9800;
    }

    @media (max-width:980px){.intro-grid{grid-template-columns:1fr}.top-right{flex-direction:column;align-items:flex-end}.timer{min-width:120px}}
  </style>
</head>
<body>
  <div class="plaque" id="plaque">–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω - –ø–∞—Ä–æ–ª—å, –°–ø—Ä–æ–±—É–π —ñ–Ω—à–∏–π.<div style="font-weight:400;font-size:12px;margin-top:6px" id="plaqueDetail"></div></div>

  <!-- Fullscreen Warning Modal -->
  <div class="fullscreen-modal" id="fullscreenModal">
    <div class="fullscreen-modal-content">
      <h3 style="color: var(--danger); margin-top: 0;">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è!</h3>
      <p id="modalMessage">–í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç—É.</p>
      <div class="fullscreen-modal-buttons">
        <button class="btn btn-primary" onclick="returnToFullscreen()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —Ç–µ—Å—Ç—É</button>
      </div>
      <p style="font-size: 12px; color: var(--text-light); margin-top: 15px;">
        <strong>–£–≤–∞–≥–∞:</strong> –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –≤–∏—Ö–æ–¥–∞—Ö —Ç–µ—Å—Ç –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–∏–º—É—Å–æ–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!
      </p>
    </div>
  </div>

  <div class="app">
    <header>
      <div class="brand">
        <h1>–û–ª—ñ–º–ø—ñ–∞–¥–∞ –∑ –ê–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏ ‚Äî 10 –∫–ª–∞—Å (Hard)</h1>
        <div class="subtitle">–§—ñ–Ω–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è ‚Äî —Ä–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.</div>
      </div>
      <div style="color:var(--text-light);font-size:13px" id="participantCounter"></div>
    </header>

    <div class="card">
      <!-- Security Warning -->
      <div class="security-warning" id="securityWarning">
        üîí <strong>–ë–µ–∑–ø–µ–∫–∞ —Ç–µ—Å—Ç—É:</strong> –û–±–º–µ–∂–µ–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤. –ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É.
      </div>

      <!-- Intro -->
      <section id="intro">
        <div class="intro-grid">
          <div>
            <form id="loginForm" class="login" onsubmit="return false">
              <div style="display:flex;gap:10px;align-items:center">
                <div style="flex:0 0 120px"><label style="font-size:12px;color:var(--text-light)">–ù–æ–º–µ—Ä —É—á–Ω—è</label><input id="studentNum" type="text" readonly></div>
                <div style="flex:1"><label style="font-size:12px;color:var(--text-light)">–õ–æ–≥—ñ–Ω</label><input id="login" type="text" placeholder="–õ–æ–≥—ñ–Ω" required></div>
                <div style="flex:1"><label style="font-size:12px;color:var(--text-light)">–ü–∞—Ä–æ–ª—å</label><input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" required></div>
              </div>

              <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
                <button id="startBtn" class="btn btn-primary" type="button">–ü–æ—á–∞—Ç–∏</button>
                <div style="color:var(--text-light);font-size:13px">–∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å Enter</div>
              </div>
            </form>
          </div>

          <aside class="info-box">
            <p><strong>–ß–∞—Å –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è:</strong> 60 –•–≤–∏–ª–∏–Ω (–ø–æ 20 —Ö–≤–∏–ª–∏–Ω –Ω–∞ –∫–æ–∂–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è)</p>
            <p><strong>–ü—ñ—Å–ª—è –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏:</strong></p>
            <p>Telegram: <code style="background:var(--muted);padding:2px 6px;border-radius:4px">@nacodexx</code></p>
            <p>Discord: <code style="background:var(--muted);padding:2px 6px;border-radius:4px">in.kyiv</code></p>
            <p style="margin-top:8px;color:var(--text-light);font-size:13px">–ù–æ–º–µ—Ä —É—á–Ω—è –∑–≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥ 1 –¥–æ 1000.</p>
            <div id="participantsInfo" style="margin-top:8px;padding:8px;background:var(--bg);border-radius:6px;font-size:12px;"></div>
          </aside>
        </div>
      </section>

      <!-- Tasks -->
      <div id="tasks">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="font-weight:700">–û–ª—ñ–º–ø—ñ–∞–¥–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –ø—Ä–∞—Ü—é–π—Ç–µ —É–≤–∞–∂–Ω–æ</div>
          <div class="top-right">
            <div class="prev-pill" id="prevBtn" onclick="goTo(prevTarget)">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</div>
            <div class="timer" id="timer">20:00</div>
          </div>
        </div>

        <!-- Fullscreen warning -->
        <div class="fullscreen-warning" id="fullscreenWarning"></div>

        <!-- Task 1: big (12 gaps) -->
        <section id="task1" class="screen">
          <div class="task-head"><div><strong>–ó–∞–≤–¥–∞–Ω–Ω—è 1</strong> ‚Äî Advanced Use of English (Gapped Text ‚Äî 12 gaps)</div><div class="hint">–í—Å—Ç–∞–≤—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Å–ª–æ–≤–∞ —É –ø—Ä–æ–ø—É—Å–∫–∏. –ö–æ–∂–µ–Ω –ø—Ä–æ–ø—É—Å–∫ ‚Äî –≤–∏–ø–∞–¥–∞—é—á–∏–π —Å–ø–∏—Å–æ–∫. –¶–µ –≤–µ–ª–∏–∫–∏–π —Ç–µ–∫—Å—Ç: –æ—Ü—ñ–Ω—ñ—Ç—å –∫–æ–∂–µ–Ω –≤–∞—Ä—ñ–∞–Ω—Ç —É–≤–∞–∂–Ω–æ.</div></div>
          <div class="task-box">
            <p class="question">Read the extended academic extract and choose the correct option for each numbered gap (12 gaps). Each gap may require subtle lexical choice.</p>

            <p style="line-height:1.6">
            Contemporary urban studies increasingly emphasize the need for <select id="t1s1"><option value="">‚Äî</option><option value="synthesis">synthesis</option><option value="fragmentation">fragmentation</option><option value="isolation">isolation</option></select> of cross-disciplinary methods. Historically, approaches that privileged narrow disciplinary perspectives resulted in policies that were <select id="t1s2"><option value="">‚Äî</option><option value="resilient">resilient</option><option value="short-sighted">short-sighted</option><option value="comprehensive">comprehensive</option></select> and lacked long-term viability. The complexity arises not only from the multiplicity of variables but also from the uneven availability of reliable data, which in many contexts is <select id="t1s3"><option value="">‚Äî</option><option value="abundant">abundant</option><option value="sporadic">sporadic</option><option value="redundant">redundant</option></select>. Consequently, models must be designed with an awareness of their inherent <select id="t1s4"><option value="">‚Äî</option><option value="limitations">limitations</option><option value="perfections">perfections</option><option value="magnitudes">magnitudes</option></select>, and stakeholders should participate to ensure that outputs are not <select id="t1s5"><option value="">‚Äî</option><option value="detached">detached</option><option value="aligned">aligned</option><option value="abstracted">abstracted</option></select> from lived experience.
            </p>

            <p style="line-height:1.6;margin-top:10px">
            Several authors have argued that the standard metrics for resilience are often <select id="t1s6"><option value="">‚Äî</option><option value="overly">overly</option><option value="rigorously">rigorously</option><option value="carefully">carefully</option></select> simplified, thereby obscuring context-specific vulnerabilities. To mitigate this, it is advisable to incorporate qualitative assessments that capture <select id="t1s7"><option value="">‚Äî</option><option value="nuance">nuance</option><option value="uniformity">uniformity</option><option value="redundancy">redundancy</option></select> and local perceptions. Moreover, when presenting findings to policymakers, researchers need to <select id="t1s8"><option value="">‚Äî</option><option value="obfuscate">obfuscate</option><option value="clarify">clarify</option><option value="complicate">complicate</option></select> the implications and offer practicable recommendations rather than abstract generalities.
            </p>

            <p style="line-height:1.6;margin-top:10px">
            A further complication is the tendency to conflate correlation with causation, especially in datasets where temporal sequences are <select id="t1s9"><option value="">‚Äî</option><option value="ambiguous">ambiguous</option><option value="obvious">obvious</option><option value="immutable">immutable</option></select>. Robust inference thus demands careful longitudinal analysis and sensitivity testing to avoid <select id="t1s10"><option value="">‚Äî</option><option value="spurious">spurious</option><option value="conclusive">conclusive</option><option value="definitive">definitive</option></select> conclusions. Finally, the ethical dimension requires that any interventions respect community autonomy and do not exacerbate pre-existing <select id="t1s11"><option value="">‚Äî</option><option value="inequalities">inequalities</option><option value="advantages">advantages</option><option value="privileges">privileges</option></select>. In summary, the framing of urban resilience must remain both critically reflexive and <select id="t1s12"><option value="">‚Äî</option><option value="adaptive">adaptive</option><option value="static">static</option><option value="naive">naive</option></select>.
            </p>

          </div>

          <div class="controls">
            <div></div>
            <div><button class="btn btn-primary" onclick="goTo(2)">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è</button></div>
          </div>
        </section>

        <!-- Task 2: long reading + 12 questions -->
        <section id="task2" class="screen">
          <div class="task-head"><div><strong>–ó–∞–≤–¥–∞–Ω–Ω—è 2</strong> ‚Äî Long Reading & Analysis (12 items)</div><div class="hint">–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–∞–∂–Ω–æ. –ü—ñ—Å–ª—è —Ç–µ–∫—Å—Ç—É ‚Äî 12 –∑–∞–≤–¥–∞–Ω—å: –ø–æ—î–¥–Ω–∞–Ω–Ω—è multiple choice —ñ –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.</div></div>
          <div class="task-box">
            <p class="question">Passage (extended):</p>
            <p style="font-size:14px;line-height:1.7">Over the last half-century, urbanization has proceeded at an unprecedented rate, compelling scholars to reassess traditional paradigms of growth and governance. Initially, urban theory emphasized industrial expansion and spatial planning as the dominant variables; however, contemporary perspectives integrate social capital, environmental integrity and digital infrastructure into cohesive frameworks. Notably, the spatial distribution of services and economic opportunity often mirrors historical inequalities, producing path-dependent outcomes. Policymakers must therefore navigate the tension between top-down planning and grassroots mobilization, leveraging participatory mechanisms without sacrificing strategic coherence. Moreover, the climatic imperative adds a new layer of complexity: mitigation policies must be equitable, financially viable and technically feasible. As cities adapt, adaptive governance ‚Äî characterized by iterative policymaking, transparent data practices and inclusive stakeholder engagement ‚Äî becomes central. Yet, the translation of evidence into policy frequently founders on institutional inertia, budgetary constraints and competing political priorities. Ultimately, resilient urban futures require a synthesis of robust data, normative commitments to justice, and pragmatic implementation pathways.</p>

            <ol style="margin-top:12px">
              <li>(short) Define in one sentence what is meant by <em>path-dependent outcomes</em> in the passage. <input id="r2q1" placeholder="one sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) Which of the following is NOT listed as part of contemporary frameworks? <select id="r2q2"><option value="">‚Äî</option><option value="A">social capital</option><option value="B">digital infrastructure</option><option value="C">agrarian reform</option></select></li>
              <li>(short) Give two barriers mentioned that impede translation of evidence into policy. <input id="r2q3" placeholder="two items" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) Adaptive governance includes: <select id="r2q4"><option value="">‚Äî</option><option value="A">iterative policymaking</option><option value="B">opaque data practices</option><option value="C">exclusionary stakeholder engagement</option></select></li>
              <li>(short) What does the passage suggest about climate mitigation policies? <input id="r2q5" placeholder="short answer" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) The passage implies that policymaking must balance: <select id="r2q6"><option value="">‚Äî</option><option value="A">top-down planning and grassroots mobilization</option><option value="B">only top-down directives</option><option value="C">only grassroots mobilization</option></select></li>
              <li>(short) Provide one example of a normative commitment mentioned. <input id="r2q7" placeholder="one word/phrase" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) What becomes central for resilient urban futures? <select id="r2q8"><option value="">‚Äî</option><option value="A">adaptive governance</option><option value="B">institutional inertia</option><option value="C">budgetary constraints</option></select></li>
              <li>(short) Explain briefly why inclusive stakeholder engagement is important according to the text. <input id="r2q9" placeholder="short answer" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) Which is listed as characteristic of adaptive governance? <select id="r2q10"><option value="">‚Äî</option><option value="A">transparent data practices</option><option value="B">political opacity</option><option value="C">reliance on randomness</option></select></li>
              <li>(short) Summarize in one phrase what is required for resilient urban futures. <input id="r2q11" placeholder="one phrase" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>(MC) Which of these is presented as a challenge to implementing policies? <select id="r2q12"><option value="">‚Äî</option><option value="A">budgetary constraints</option><option value="B">robust data</option><option value="C">normative commitments</option></select></li>
            </ol>

          </div>

          <div class="controls">
            <div></div>
            <div><button class="btn btn-primary" onclick="goTo(3)">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è</button></div>
          </div>
        </section>

        <!-- Task 3: 10 transformation tasks -->
        <section id="task3" class="screen">
          <div class="task-head"><div><strong>–ó–∞–≤–¥–∞–Ω–Ω—è 3</strong> ‚Äî Transformations (10 items)</div><div class="hint">–ü–µ—Ä–µ–ø–∏—à—ñ—Ç—å —Ä–µ—á–µ–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–ª–æ–≤–æ –≤ –¥—É–∂–∫–∞—Ö ‚Äî –∑–±–µ—Ä–µ–≥—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è.</div></div>
          <div class="task-box">
            <ol>
              <li>It was unnecessary to wake him. (NEED) ‚Äî <input id="t3q1" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>She completed the task despite the difficulties. (MANAGED) ‚Äî <input id="t3q2" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>They started the project two years ago. (BEEN) ‚Äî <input id="t3q3" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>He didn't need to bring any tools. (WAS) ‚Äî <input id="t3q4" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>It's illegal to drive without a license. (PERMITTED) ‚Äî <input id="t3q5" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>They regret not applying earlier. (WISH) ‚Äî <input id="t3q6" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>I prefer tea to coffee. (RATHER) ‚Äî <input id="t3q7" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>She hasn't seen him for months. (LAST) ‚Äî <input id="t3q8" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>It's impossible to finish on time without help. (ABLE) ‚Äî <input id="t3q9" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
              <li>The teacher insisted on early submission. (DEMAND) ‚Äî <input id="t3q10" placeholder="Your sentence" style="width:100%;padding:6px;border-radius:6px;border:1px solid var(--border);background:var(--bg);color:var(--text-dark)"></li>
            </ol>
          </div>

          <div class="controls">
            <div></div>
            <div>
              <button class="btn btn-ghost" id="prevHidden" onclick="goTo(2)">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
              <button class="btn btn-danger" id="finishBtn" onclick="finishTest()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
            </div>
          </div>
        </section>

        <!-- View Mode Navigation -->
        <div class="view-nav" id="viewNav">
          <button class="view-nav-btn" id="prevViewBtn" onclick="navigateView(-1)">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—î</button>
          <button class="view-nav-btn" id="nextViewBtn" onclick="navigateView(1)">–ù–∞—Å—Ç—É–ø–Ω–µ ‚Üí</button>
        </div>

        <div id="resultPanel" class="result">
          <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–∞ –ø—ñ–¥—Å—É–º–∫–∏ —á–∞—Å—É</h3>
          <div id="scoreText"></div>
          <div id="timeSummary" style="margin-top:8px;color:var(--text-light)"></div>
          <div id="fullscreenSummary" style="margin-top:8px;color:var(--text-light)"></div>
          <div id="answersList" style="margin-top:10px"></div>
          <div style="margin-top:10px"><button id="viewAnswersBtn" class="btn btn-ghost" style="font-weight:700;">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</button></div>
          <p style="margin-top:8px;font-size:13px;color:var(--text-light)">–ù–∞–¥—ñ—à–ª—ñ—Ç—å –≤–∞—à—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ç–æ—Ä—É –∑–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∑ –≤—Å—Ç—É–ø–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏.</p>
          <div style="margin-top:6px;font-size:14px"><strong>–ö–æ–Ω—Ç–∞–∫—Ç–∏ —ñ –Ω–æ–º–µ—Ä —É—á–Ω—è:</strong><div id="contactBlock" style="margin-top:6px"></div></div>
        </div>

      </div>

      <footer class="note">–ü–æ—Ä–∞–¥–∞: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –∑–≤–µ—Ä—Ö—É, —â–æ–± –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –º—ñ–∂ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–µ—Å—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±—É–¥—É—Ç—å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ ‚Äî –∞–ª–µ —ó—Ö –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–Ω–æ–ø–∫–æ—é ¬´–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ¬ª.</footer>
    </div>
  </div>

  <script>
    // --- Security Settings ---
    const MAX_PARTICIPANTS = 1000;
    let participantCount = 0;
    let participantsStarted = 0;

    // --- State ---
    const studentNumEl = document.getElementById('studentNum');
    const loginEl = document.getElementById('login');
    const passEl = document.getElementById('password');
    const plaque = document.getElementById('plaque');
    const plaqueDetail = document.getElementById('plaqueDetail');
    const startBtn = document.getElementById('startBtn');
    const tasks = document.getElementById('tasks');
    const screens = {1:document.getElementById('task1'),2:document.getElementById('task2'),3:document.getElementById('task3')};
    const timerEl = document.getElementById('timer');
    const prevBtn = document.getElementById('prevBtn');
    const resultPanel = document.getElementById('resultPanel');
    const contactBlock = document.getElementById('contactBlock');
    const viewAnswersBtn = document.getElementById('viewAnswersBtn');
    const viewNav = document.getElementById('viewNav');
    const fullscreenWarning = document.getElementById('fullscreenWarning');
    const fullscreenModal = document.getElementById('fullscreenModal');
    const modalMessage = document.getElementById('modalMessage');
    const securityWarning = document.getElementById('securityWarning');
    const participantCounter = document.getElementById('participantCounter');
    const participantsInfo = document.getElementById('participantsInfo');

    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ localStorage
    const currentUser = JSON.parse(localStorage.getItem('current_user'));
    if (!currentUser) {
        window.location.href = 'index.html';
        throw new Error('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π');
    }

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
    const REQ_LOGIN = currentUser.login;
    const REQ_PASS = currentUser.password;

    // timers: seconds remaining for each task (20 minutes = 1200s)
    const INITIAL = 20*60;
    let remaining = {1:INITIAL,2:INITIAL,3:INITIAL};
    let activeTask = null;
    let timerInterval = null;
    let prevTarget = 1;
    let finished = false;
    let viewMode = false;
    let currentViewTask = 1;
    let fullscreenExitCount = 0;
    let fullscreenWarningShown = false;

    // scoring plan
    const RAW_MAX = 34;

    // –ù–û–í–ê –§–£–ù–ö–¶–Ü–Ø: –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ –≤–∏–¥–∏–º–æ—Å—Ç—ñ
    function handleVisibilityChange() {
      if(document.hidden && !finished) {
        pauseTimer(); 
      } else if(activeTask && !finished && !viewMode) {
        startTimerFor(activeTask); 
      }
    }

    // Security functions
    function checkParticipantLimit() {
        participantCount++;
        participantsStarted++;
        
        updateParticipantCounters();
        
        if(participantCount > MAX_PARTICIPANTS) {
            alert('–û–ª—ñ–º–ø—ñ–∞–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ—Å—è–≥–Ω—É—Ç–∞. –î—è–∫—É—î–º–æ –∑–∞ —É—á–∞—Å—Ç—å!');
            document.body.innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: var(--bg); color: white; flex-direction: column;">
                    <h1>–û–ª—ñ–º–ø—ñ–∞–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ</h1>
                    <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ—Å—è–≥–Ω—É—Ç–∞ (${MAX_PARTICIPANTS})</p>
                    <p style="margin-top: 20px; font-size: 14px; color: var(--text-light);">–î—è–∫—É—î–º–æ –∑–∞ —ñ–Ω—Ç–µ—Ä–µ—Å –¥–æ –Ω–∞—à–æ—ó –æ–ª—ñ–º–ø—ñ–∞–¥–∏!</p>
                </div>
            `;
            return false;
        }
        return true;
    }

    function updateParticipantCounters() {
        if (participantCounter) {
            participantCounter.innerHTML = `–£—á–∞—Å–Ω–∏–∫—ñ–≤: ${participantsStarted}/${MAX_PARTICIPANTS}`;
        }
        if (participantsInfo) {
            const remainingSlots = MAX_PARTICIPANTS - participantsStarted;
            participantsInfo.innerHTML = `–ó–∞–ª–∏—à–∏–ª–æ—Å—å –º—ñ—Å—Ü—å: <strong>${remainingSlots}</strong>`;
            
            if (remainingSlots < 10) {
                participantsInfo.style.background = '#cc7a00';
                participantsInfo.style.borderLeft = '4px solid #ff9800';
            }
        }
    }

    // Initialize student number on page load
    function initializeStudentNumber() {
      function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}
      studentNumEl.value = randInt(1,1000);
      updateParticipantCounters();
      
      // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ª–æ–≥—ñ–Ω –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
      loginEl.value = REQ_LOGIN;
    }

    // Call initialization when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeStudentNumber();
    });

    // Fullscreen tracking
    document.addEventListener('fullscreenchange', handleFullscreenExit);

    function handleFullscreenExit() {
      if (!document.fullscreenElement && !finished) {
        fullscreenExitCount++;
        
        // Pause timer when exiting fullscreen
        pauseTimer();
        
        // Show modal warning
        showFullscreenModal();
      
      // Update warning message
      updateFullscreenWarning();
      
      // Auto-finish test if too many exits
      if (fullscreenExitCount >= 10 && !finished) {
        setTimeout(() => {
          if (!document.fullscreenElement) {
            forceFinishTest();
          }
        }, 2000);
      }
    }

    function showFullscreenModal() {
      let message = '';
      
      if (fullscreenExitCount === 1) {
        message = '–í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç—É.';
      } else if (fullscreenExitCount <= 3) {
        message = `–í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –≤–∂–µ ${fullscreenExitCount} —Ä–∞–∑–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç—É.`;
      } else if (fullscreenExitCount <= 9) {
        message = `–£–í–ê–ì–ê! –í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –≤–∂–µ ${fullscreenExitCount} —Ä–∞–∑—ñ–≤!<br>–Ø–∫—â–æ –≤–∏ –±—É–¥–µ—Ç–µ —á–∞—Å—Ç–æ –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É, —Ç–µ—Å—Ç –±—É–¥–µ –ø—Ä–∏–º—É—Å–æ–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`;
      } else {
        message = `–ö–†–ò–¢–ò–ß–ù–û! –í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –≤–∂–µ ${fullscreenExitCount} —Ä–∞–∑—ñ–≤!<br>–¢–µ—Å—Ç –±—É–¥–µ –ø—Ä–∏–º—É—Å–æ–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`;
      }
      
      modalMessage.innerHTML = message;
      fullscreenModal.style.display = 'flex';
    }

    function returnToFullscreen() {
      fullscreenModal.style.display = 'none';
      try {
        if (document.documentElement.requestFullscreen) {
          document.documentElement.requestFullscreen().catch(e => {
            console.log('Fullscreen failed:', e);
          });
        }
      } catch(e) {
        console.log('Fullscreen error:', e);
      }
      // Resume timer when returning to fullscreen
      if (activeTask && !finished && !viewMode) {
        startTimerFor(activeTask);
      }
    }

    function updateFullscreenWarning() {
      if (fullscreenExitCount > 0 && !finished) {
        fullscreenWarning.style.display = 'block';
        fullscreenWarning.textContent = `–£–≤–∞–≥–∞! –í–∏ –≤–∏–π—à–ª–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É ${fullscreenExitCount} —Ä–∞–∑—ñ–≤.`;
        
        if (fullscreenExitCount >= 3 && fullscreenExitCount <= 9) {
          fullscreenWarning.innerHTML += `<br><strong>–Ø–∫—â–æ –≤–∏ –±—É–¥–µ—Ç–µ —á–∞—Å—Ç–æ –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É, —Ç–µ—Å—Ç –±—É–¥–µ –ø—Ä–∏–º—É—Å–æ–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</strong>`;
        } else if (fullscreenExitCount >= 10) {
          fullscreenWarning.innerHTML += `<br><strong>–¢–ï–°–¢ –ë–£–î–ï –ü–†–ò–ú–£–°–û–í–û –ó–ê–í–ï–†–®–ï–ù–û!</strong>`;
        }
      }
    }

    function forceFinishTest() {
      if (!finished) {
        // Show final warning
        fullscreenWarning.style.display = 'block';
        fullscreenWarning.innerHTML = `<strong>–¢–ï–°–¢ –ü–†–ò–ú–£–°–û–í–û –ó–ê–í–ï–†–®–ï–ù–û!</strong><br>–ó–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –≤–∏—Ö–æ–¥—ñ–≤ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É (${fullscreenExitCount} —Ä–∞–∑—ñ–≤)`;
        
        // Finish test
        finishTest();
        
        // Add special message to results
        const fullscreenSummary = document.getElementById('fullscreenSummary');
        if (fullscreenSummary) {
          fullscreenSummary.innerHTML = `<span style="color:var(--danger);font-weight:700;">
            –¢–ï–°–¢ –ü–†–ò–ú–£–°–û–í–û –ó–ê–í–ï–†–®–ï–ù–û!<br>
            ${fullscreenExitCount} —Ä–∞–∑—ñ–≤ –≤–∏—Ö–æ–¥–∏–≤, —à–æ —Å–ø–∏—Å–∞–≤? –ù—É —Ç–æ–¥—ñ 1 –±–∞–ª.<br>
            –ì–∞—Ä–∞–∑–¥, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–µ—à —Ü–µ–π —Ç–µ—Å—Ç —É –æ—á–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ :)
          </span>`;
        }
      }
    }

    // plaque: slide up without overlapping inputs (stays above bottom)
    function showPlaque(detail){
      plaque.style.display='block';
      plaque.style.transition='transform 0.35s ease, opacity 1s linear';
      plaque.style.opacity='1';
      plaque.style.transform = 'translateX(-50%) translateY(0%)';
      plaqueDetail.textContent = detail || '';
      setTimeout(()=>{ plaque.style.opacity='0'; },5000);
      setTimeout(()=>{ plaque.style.display='none'; plaque.style.transform='translateX(-50%) translateY(110%)'; plaqueDetail.textContent=''; },6100);
    }

    function validateLogin(){
      const L = loginEl.value.trim();
      const P = passEl.value.trim();
      if(L !== REQ_LOGIN || P !== REQ_PASS){
        const detail = (L !== REQ_LOGIN && P !== REQ_PASS) ? '(–ª–æ–≥—ñ–Ω —ñ –ø–∞—Ä–æ–ª—å –Ω–µ–≤—ñ—Ä–Ω—ñ)' : (L !== REQ_LOGIN ? '(–ª–æ–≥—ñ–Ω –Ω–µ–≤—ñ—Ä–Ω–∏–π)' : '(–ø–∞—Ä–æ–ª—å –Ω–µ–≤—ñ—Ä–Ω–∏–π)');
        document.getElementById('plaque').textContent = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω - –ø–∞—Ä–æ–ª—å, –°–ø—Ä–æ–±—É–π —ñ–Ω—à–∏–π.';
        const small = document.createElement('div'); 
        small.style.fontWeight='400'; 
        small.style.fontSize='12px'; 
        small.style.marginTop='6px'; 
        small.textContent = detail;
        plaque.appendChild(small);
        showPlaque(detail);
        setTimeout(()=>{ if(plaque.lastChild) plaque.removeChild(plaque.lastChild); },6100);
        return false;
      }
      return true;
    }

    startBtn.addEventListener('click', ()=>{
      if(!validateLogin()) return;
      
      // Check participant limit
      if(!checkParticipantLimit()) return;
      
      // request fullscreen
      try{ 
        if(document.documentElement.requestFullscreen) 
          document.documentElement.requestFullscreen().catch(e => console.log('Fullscreen failed:', e)); 
      }
      catch(e){ /* ignore */ }
      document.getElementById('intro').style.display='none';
      tasks.style.display='block';
      goTo(1);
    });

    // navigation and timer
    function showScreen(n){
      for(const k in screens) {
        if(screens[k]) screens[k].classList.remove('active');
      }
      if(screens[n]) screens[n].classList.add('active');
      activeTask = n;
      prevTarget = n-1 >=1 ? n-1 : 1;
      if(prevBtn) {
        prevBtn.style.display = n>1 ? 'inline-block' : 'none';
        prevBtn.onclick = ()=>{ goTo(prevTarget); }
      }
      if(!finished && !viewMode) startTimerFor(n);
    }

    function goTo(n){
      if(activeTask===n) return;
      if(activeTask && !viewMode) pauseTimer();
      showScreen(n);
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function startTimerFor(n){
      pauseTimer();
      timerInterval = setInterval(()=>{
        if(remaining[n] > 0) remaining[n]--;
        updateTimerDisplay(remaining[n]);
        if(remaining[n] === 0){
          clearInterval(timerInterval);
          if(n < 3) goTo(n+1);
        }
      },1000);
      updateTimerDisplay(remaining[n]);
    }

    function pauseTimer(){ 
      if(timerInterval) {
        clearInterval(timerInterval); 
        timerInterval = null; 
      }
    }
    
    function updateTimerDisplay(sec){ 
      const m=Math.floor(sec/60).toString().padStart(2,'0'); 
      const s=(sec%60).toString().padStart(2,'0'); 
      if(timerEl) timerEl.textContent = `${m}:${s}`; 
    }
    
    // Initialize timer display
    updateTimerDisplay(INITIAL);

    // View mode navigation
    function navigateView(direction) {
      currentViewTask += direction;
      if (currentViewTask < 1) currentViewTask = 1;
      if (currentViewTask > 3) currentViewTask = 3;
      
      showScreen(currentViewTask);
      updateViewNavButtons();
    }

    function updateViewNavButtons() {
      if(document.getElementById('prevViewBtn') && document.getElementById('nextViewBtn')) {
        document.getElementById('prevViewBtn').disabled = currentViewTask === 1;
        document.getElementById('nextViewBtn').disabled = currentViewTask === 3;
      }
    }

    // correct answers maps
    const correctTask1 = {
      t1s1:'synthesis', 
      t1s2:'short-sighted', 
      t1s3:'sporadic', 
      t1s4:'limitations', 
      t1s5:'detached', 
      t1s6:'overly', 
      t1s7:'nuance', 
      t1s8:'clarify', 
      t1s9:'ambiguous', 
      t1s10:'spurious', 
      t1s11:'inequalities', 
      t1s12:'adaptive'
    };
    
    const correctTask2MC = {
      r2q2:'C', 
      r2q4:'A', 
      r2q6:'A', 
      r2q8:'A', 
      r2q10:'A', 
      r2q12:'A'
    };

    function checkShort(id, arr){ 
      const el = document.getElementById(id);
      if(!el) return false;
      const v = el.value.trim().toLowerCase(); 
      if(!v) return false; 
      return arr.some(w=>v.includes(w)); 
    }

    // evaluate and finish
function finishTest(){
  if(finished) return;
  finished = true;
  pauseTimer();
  
  // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–º–∏–∫–∞—î–º–æ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–µ—Å—Ç—É
  document.removeEventListener('fullscreenchange', handleFullscreenExit);
  document.removeEventListener('visibilitychange', handleVisibilityChange);
  
  // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—Ö–æ–¥–∏–º–æ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
  if (document.fullscreenElement) {
    document.exitFullscreen().catch(e => {
      console.log('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É:', e);
    });
  }
  
  // Close fullscreen modal if open
  fullscreenModal.style.display = 'none';
  
  // lock inputs except view button and navigation
  Array.from(document.querySelectorAll('input,select,textarea,button')).forEach(el=>{ 
    if(el.id !== 'viewAnswersBtn' && !el.classList.contains('view-nav-btn')) 
      el.disabled = true; 
  });

  // scoring
  let rawScore = 0;
  
  // task1 (12 gaps)
  for(let i=1;i<=12;i++){
    const id = 't1s'+i; 
    const el = document.getElementById(id); 
    if(el) {
      const val = el.value; 
      if(val && val === correctTask1[id]) rawScore++; 
    }
  }
  
  // task2 MCs
  Object.keys(correctTask2MC).forEach(id=>{ 
    const el = document.getElementById(id);
    if(el) {
      const v = el.value; 
      if(v && v === correctTask2MC[id]) rawScore++; 
    }
  });
  
  // task2 shorts: r2q1,r2q3,r2q5,r2q7,r2q9,r2q11 (6 items) - use keyword checks
  if(checkShort('r2q1',['path','dependent','histor'])) rawScore++;
  if(checkShort('r2q3',['inertia','budget','constraint','budgetary','politic'])) rawScore++;
  if(checkShort('r2q5',['equitable','viable','feasible'])) rawScore++;
  if(checkShort('r2q7',['justice'])) rawScore++;
  if(checkShort('r2q9',['includ','particip','stakehold','engag'])) rawScore++;
  if(checkShort('r2q11',['synthesis','data','justice','pragmatic'])) rawScore++;
  
  // task3: mark non-empty as provisional correct
  for(let i=1;i<=10;i++){ 
    const el = document.getElementById('t3q'+i);
    if(el) {
      const v = el.value.trim(); 
      if(v.length>3) rawScore++; 
    }
  }
  
  if(rawScore > RAW_MAX) rawScore = RAW_MAX;
  const final12 = Math.round(rawScore / RAW_MAX * 12);

  if(document.getElementById('scoreText')) {
    document.getElementById('scoreText').innerHTML = `–°–∏—Ä—ñ –±–∞–ª–∏: <strong>${rawScore}</strong> –∑ ${RAW_MAX}. –û—Ü—ñ–Ω–∫–∞ –∑–∞ 12-–±–∞–ª—å–Ω–æ—é —à–∫–∞–ª–æ—é: <strong>${final12}/12</strong>`;
  }

  const totalRemain = remaining[1] + remaining[2] + remaining[3]; 
  const used = 3*INITIAL - totalRemain; 
  const mins = Math.floor(totalRemain/60); 
  const secs = totalRemain%60;
  
  if(document.getElementById('timeSummary')) {
    document.getElementById('timeSummary').innerHTML = `–ó–∞–ª–∏—à–æ–∫ —á–∞—Å—É –ø–æ –∑–∞–≤–¥–∞–Ω–Ω—è—Ö: <strong>${mins} —Ö–≤ ${secs} —Å</strong>. –ó–∞–≥–∞–ª—å–Ω–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —á–∞—Å: ${Math.floor(used/60)} —Ö–≤ ${used%60} —Å.`;
  }

  // Fullscreen summary with special messages
  if(document.getElementById('fullscreenSummary')) {
    let fullscreenText = `–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏—Ö–æ–¥—ñ–≤ –∑ –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É: ${fullscreenExitCount}`;
    
    if (fullscreenExitCount >= 3 && fullscreenExitCount <= 9) {
      fullscreenText += `<br><span style="color:var(--danger);font-weight:700;">
        ${fullscreenExitCount} —Ä–∞–∑—ñ–≤ –≤–∏—Ö–æ–¥–∏–≤, —à–æ —Å–ø–∏—Å–∞–≤? –ù—É —Ç–æ–¥—ñ 1 –±–∞–ª.<br>
        –ì–∞—Ä–∞–∑–¥, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–µ—à —Ü–µ–π —Ç–µ—Å—Ç —É –æ—á–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ :)
      </span>`;
    } else if (fullscreenExitCount >= 10) {
      fullscreenText += `<br><span style="color:var(--danger);font-weight:700;">
        –¢–ï–°–¢ –ü–†–ò–ú–£–°–û–í–û –ó–ê–í–ï–†–®–ï–ù–û!<br>
        ${fullscreenExitCount} —Ä–∞–∑—ñ–≤ –≤–∏—Ö–æ–¥–∏–≤, —à–æ —Å–ø–∏—Å–∞–≤? –ù—É —Ç–æ–¥—ñ 1 –±–∞–ª.<br>
        –ì–∞—Ä–∞–∑–¥, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–µ—à —Ü–µ–π —Ç–µ—Å—Ç —É –æ—á–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ :)
      </span>`;
    }
    
    document.getElementById('fullscreenSummary').innerHTML = fullscreenText;
  }

  // prepare answers list (summary)
  const list = document.getElementById('answersList');
  if(list) {
    list.innerHTML='';
    list.innerHTML = '<div style="font-weight:700;margin-bottom:8px">–ö–æ—Ä–æ—Ç–∫–∏–π –∑–≤—ñ—Ç –ø–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º:</div>';
    // show counts
    list.innerHTML += `<div>–°–∏—Ä—ñ –±–∞–ª–∏: <strong>${rawScore}</strong> ‚Üí <strong>${final12}/12</strong></div>`;
  }

  // contacts
  if(contactBlock) {
    contactBlock.innerHTML = `Telegram: <code>@nacodexx</code><br>Discord: <code>in.kyiv</code><br>–ù–æ–º–µ—Ä —É—á–Ω—è: <strong>${studentNumEl.value}</strong>`;
  }

  // reveal result and show view button
  if(resultPanel) {
    resultPanel.style.display='block';
  }
  if(viewAnswersBtn) {
    viewAnswersBtn.disabled = false;
  }

  // freeze timers display (do not change further)
  pauseTimer();
}

    // view answers: highlight correct/incorrect and allow navigation (read-only)
    function applyHighlights(){
      // task1
      for(let i=1;i<=12;i++){
        const id='t1s'+i; 
        const el=document.getElementById(id); 
        if(!el) continue; 
        const val=el.value; 
        if(!val){ 
          el.classList.add('wrong-bg'); 
          continue; 
        } 
        if(val === correctTask1[id]) 
          el.classList.add('correct-bg'); 
        else 
          el.classList.add('wrong-bg'); 
      }
      
      // task2 MCs
      Object.keys(correctTask2MC).forEach(id=>{ 
        const el=document.getElementById(id); 
        if(!el) return; 
        const val=el.value; 
        if(val === correctTask2MC[id]) 
          el.classList.add('correct-bg'); 
        else 
          el.classList.add('wrong-bg'); 
      });
      
      // task2 shorts highlight if matched keywords
      const shortChecks = {
        'r2q1':['path','dependent','histor'],
        'r2q3':['inertia','budget','constraint','budgetary','politic'],
        'r2q5':['equitable','viable','feasible'],
        'r2q7':['justice'],
        'r2q9':['includ','particip','stakehold','engag'],
        'r2q11':['synthesis','data','justice','pragmatic']
      };
      
      Object.keys(shortChecks).forEach(id=>{ 
        const el=document.getElementById(id); 
        if(!el) return; 
        if(checkShort(id, shortChecks[id])) 
          el.classList.add('correct-bg'); 
        else 
          el.classList.add('wrong-bg'); 
      });
      
      // task3: non-empty -> correct, empty -> wrong
      for(let i=1;i<=10;i++){ 
        const el=document.getElementById('t3q'+i); 
        if(!el) continue; 
        if(el.value.trim().length>3) 
          el.classList.add('correct-bg'); 
        else 
          el.classList.add('wrong-bg'); 
      }
    }

    if(viewAnswersBtn) {
      viewAnswersBtn.addEventListener('click', ()=>{
        // enable navigation between tasks while keeping inputs disabled
        viewMode = true;
        // show navigation buttons
        if(viewNav) viewNav.style.display = 'flex';
        // apply highlights
        applyHighlights();
        // make sure all inputs remain disabled but navigation works
        Array.from(document.querySelectorAll('input,select,textarea')).forEach(el=>{ el.disabled = true; });
        // ensure prev/next visible
        if(prevBtn) prevBtn.style.display = 'inline-block';
        // go to first task for viewing
        currentViewTask = 1;
        goTo(1);
        updateViewNavButtons();
        // visually indicate view mode
        viewAnswersBtn.disabled = true;
      });
    }

    // expose functions
    window.goTo = function(n){ 
      if(activeTask && !viewMode) pauseTimer(); 
      showScreen(n); 
    }
    window.finishTest = finishTest;
    window.navigateView = navigateView;
    window.returnToFullscreen = returnToFullscreen;

    // keyboard enter
    const loginForm = document.getElementById('loginForm');
    if(loginForm) {
      loginForm.addEventListener('keydown', (e)=>{ 
        if(e.key === 'Enter'){ 
          startBtn.click(); 
        } 
      });
    }

    // on visibility change pause timers
    document.addEventListener('visibilitychange', ()=>{ 
      if(document.hidden) {
        pauseTimer(); 
      } else if(activeTask && !finished && !viewMode) {
        startTimerFor(activeTask); 
      }
    });
  </script>
</body>
</html>
